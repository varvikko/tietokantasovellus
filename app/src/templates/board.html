<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ board[path] }}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/board.css')}}" />
</head>

<body>
    {% extends "layout.html" %} {% block content %}

    <div class="board__content">

        <div class="board__header">
            <h1 class="board--title">{{ board['path'] }} - {{ board['name'] }}</h1>
            <p class="board--description">{{ board['description'] }}</p>
        </div>

        <div class="form__wrapper">
            <form class="board__form--new" action="/new-thread" method="POST" enctype="multipart/form-data">
                <div class="form__element">
                    <label for="board-content" class="form__label">Content</label>
                    <textarea id="board-content" name="content"></textarea>
                </div>
                <div class="form__element">
                    <label for="board-image" class="form__label">Image</label>
                    <input type="file" id="board-image" name="image" />
                </div>
                <input type="hidden" value="{{board['path']}}" name="board" />
                <input type="submit" value="Create" />
            </form>
        </div>

        {% if threads|length == 0 %}
        <h1 class="threads--none">No threads</h1>
        {% endif %}

        <div class="board__threads">
            {% for thread in threads %}
            <div class="thread">
                <div class="thread__header">
                    <a href="/thread/{{ thread[0]['id'] }}">
                        {{ thread[0]['body'] }}
                    </a>
                </div>
                {% for post in thread %}


                <div class="post">
                    <div class="post__header">
                        <div class="post__header--side">
                            {% if post['author'] %}
                            <p class="post--author">{{ post['author'] }}</p>
                            {% endif %}
                            <p class="bold">No. {{ post['id']}}</p>
                            <p>{{ post['created_at'] }}</p>
                        </div>

                        {% if post.id == thread[0].id %}
                        <div class="post__header--side">
                            <a href="/hide/{{ thread[0].id }}?returnto={{board.path}}">[Hide]</a>
                        </div>
                        {% endif %}
                    </div>

                    <div class="post__body">
                        {% if post['filename'] %}
                        <div class="post__image--wrapper">
                            <img src="/i/{{ post['filename'] }}" class="post__image" />
                        </div>
                        {% endif %}

                        <div class="post__content">
                            <p>

                                {% for line in post['body'].splitlines() %} {% for t in line | split %} {%- if t.url -%}
                                <a class="reply--link" href="/post/{{ t.content[2:] }}">{{ t.content }}</a>{%- else -%}{{t.content}}{%- endif -%}{% endfor %}
                                <br> {% endfor %}
                            </p>
                        </div>
                    </div>

                    <div class="post__footer">
                        {% if post['replies'] %}
                        <p class="replies--title">Replies:</p>
                        <ul class="replies--list">
                            {% for reply in post['replies'] %}
                            <li><a class="reply--link" href="/post/{{ reply }}">&gt;&gt;{{ reply }}</a></li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>

                {% if post == thread[0] %}
                <div class="thread--replies">
                    {{ thread[0].post_count }} replies
                </div>
                {% endif %} {% endfor %}
            </div>
            {% endfor %}
        </div>

        <div class="board__navigation">
            {% set start_index = page - 3 %} {% if start_index
            < 1 %} {% set start_index=1 %} {% endif %} {% set end_index=start_index + 7 %} {% for i in range(start_index, end_index) %} {% if i==page %} <a href="{{ board['path'] }}{{ i }}" class="current--board">{{ i }}</a>
                {% else %}
                <a href="{{ board['path'] }}{{ i }}">{{ i }}</a> {% endif %} {% endfor %}
        </div>
        {% endblock %}
</body>

</html>